This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
eslint.config.js
index.html
package.json
postcss.config.js
public/vite.svg
README.md
src/App.css
src/App.jsx
src/assets/react.svg
src/components/CollaboratorModal.jsx
src/components/Controls.jsx
src/components/Header.jsx
src/components/LoginModal.jsx
src/components/NoteCard.jsx
src/components/NoteModal.jsx
src/components/NoteModal/FileUploadArea.jsx
src/components/NoteModal/ImageUploadArea.jsx
src/components/NoteModal/VoiceRecorderArea.jsx
src/context/AuthContext.jsx
src/index.css
src/main.jsx
src/pages/Dashboard.js
src/services/api.js
src/services/auth.js
src/services/notificationService.js
src/utils/helpers.js
tailwind.config.js
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IngetinAja ‚Äî Catatan Pintar</title>
    <!-- Tambahkan Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "ingetinaja-frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint . --ext js,jsx --report-unused-disable-directives --max-warnings 0",
    "preview": "vite preview"
  },
  "dependencies": {
    "axios": "^1.13.2",
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.37",
    "@types/react-dom": "^18.2.15",
    "@vitejs/plugin-react": "^4.1.1",
    "autoprefixer": "^10.4.16",
    "eslint": "^8.53.0",
    "eslint-plugin-react": "^7.33.2",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.4.4",
    "postcss": "^8.4.31",
    "tailwindcss": "^3.3.5",
    "vite": "^4.5.0"
  }
}
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="README.md">
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/App.jsx">
import React, { useState, useEffect } from "react";
import Header from "./components/Header.jsx";
import LoginModal from "./components/LoginModal.jsx";
import NoteModal from "./components/NoteModal.jsx";
import Controls from "./components/Controls.jsx";
import NoteCard from "./components/NoteCard.jsx";
import { AuthProvider, useAuth } from "./context/AuthContext.jsx";
import { notesService } from "./services/api.js";
import { notificationService } from "./services/notificationService.js";
import "./index.css";

function AppContent() {
  const { user, isAuthenticated, loading: authLoading } = useAuth();
  const [notes, setNotes] = useState([]);
  const [showLoginModal, setShowLoginModal] = useState(false);
  const [showNoteModal, setShowNoteModal] = useState(false);
  const [editingNote, setEditingNote] = useState(null);
  const [filter, setFilter] = useState("all");
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  // Initialize notification service
  useEffect(() => {
    // Request notification permission saat app load
    notificationService.requestPermission();

    // Cleanup saat component unmount
    return () => {
      notificationService.stop();
    };
  }, []);

  // Schedule notifications ketika notes berubah
  useEffect(() => {
    if (isAuthenticated && notes.length > 0) {
      scheduleAllReminderNotifications();
    }
  }, [notes, isAuthenticated]);

  const scheduleAllReminderNotifications = () => {
    // Cancel semua notifications sebelumnya
    notificationService.cancelAllNotifications();

    // Schedule notifications untuk semua notes dengan reminder
    notes.forEach((note) => {
      if (note.reminder) {
        notificationService.scheduleReminderNotification(note, note.reminder);
      }
    });
  };

  useEffect(() => {
    if (isAuthenticated) {
      loadNotes();
    } else {
      setLoading(false);
    }
  }, [isAuthenticated, filter]);

  const loadNotes = async () => {
    try {
      setLoading(true);
      setError(null);
      const data = await notesService.getAllNotes(filter);
      setNotes(data || []); // Pastikan selalu array
    } catch (error) {
      console.error("Error loading notes:", error);
      setError("Gagal memuat catatan: " + error.message);
      setNotes([]); // Set empty array jika error
    } finally {
      setLoading(false);
    }
  };

  const handleCreateNote = () => {
    if (!isAuthenticated) {
      setShowLoginModal(true);
      return;
    }
    setEditingNote(null);
    setShowNoteModal(true);
  };

  const handleEditNote = (note) => {
    setEditingNote(note);
    setShowNoteModal(true);
  };

  const handleSaveNote = async (noteData) => {
    try {
      setError(null);
      let result;
      if (editingNote) {
        result = await notesService.updateNote(editingNote.id, noteData);
        // Pastikan result.data ada
        const updatedNote = result.data || result.note || result;

        // Cancel notifications lama dan schedule yang baru
        notificationService.cancelNoteNotifications(editingNote.id);
        if (noteData.reminder) {
          notificationService.scheduleReminderNotification(
            updatedNote,
            noteData.reminder
          );
        }

        setNotes((prevNotes) =>
          prevNotes.map((note) =>
            note.id === editingNote.id ? updatedNote : note
          )
        );
      } else {
        result = await notesService.createNote(noteData);
        // Pastikan result.data ada
        const newNote = result.data || result.note || result;

        // Schedule notification untuk note baru
        if (noteData.reminder) {
          notificationService.scheduleReminderNotification(
            newNote,
            noteData.reminder
          );
        }

        setNotes((prevNotes) => [newNote, ...prevNotes]);
      }
      setShowNoteModal(false);
      setEditingNote(null);
    } catch (error) {
      console.error("Error saving note:", error);
      setError("Gagal menyimpan note: " + error.message);
    }
  };

  const handleDeleteNote = async (noteId) => {
    if (!window.confirm("Yakin ingin menghapus note ini?")) return;

    try {
      setError(null);
      const result = await notesService.deleteNote(noteId);

      if (result.status === "success") {
        // Cancel notifications untuk note yang dihapus
        notificationService.cancelNoteNotifications(noteId);

        // Hapus note dari state
        setNotes((prevNotes) => prevNotes.filter((note) => note.id !== noteId));
      } else {
        throw new Error(result.message || "Gagal menghapus note");
      }
    } catch (error) {
      console.error("Error deleting note:", error);
      setError(
        "Gagal menghapus note: " +
          (error.response?.data?.message || error.message)
      );
    }
  };

  // Filter notes dengan safety check
  const filteredNotes = (notes || []).filter((note) => {
    if (!note) return false; // Skip jika note undefined

    switch (filter) {
      case "withReminder":
        return note.reminder;
      case "withoutReminder":
        return !note.reminder;
      case "shared":
        return note.collaborators && note.collaborators.length > 0;
      default:
        return true;
    }
  });

  if (authLoading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-blue-50 flex items-center justify-center">
        <div className="text-center">
          <div className="w-14 h-14 rounded-xl bg-gradient-to-tr from-indigo-600 to-violet-500 flex items-center justify-center text-white text-2xl font-extrabold shadow-lg mx-auto mb-4">
            IA
          </div>
          <p className="text-gray-600">Loading...</p>
        </div>
      </div>
    );
  }

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-blue-50 p-6 font-sans">
        <Header onLoginClick={() => setShowLoginModal(true)} />
        <div className="max-w-6xl mx-auto text-center py-20">
          <h2 className="text-2xl font-bold text-gray-800 mb-4">
            Selamat datang di IngetinAja
          </h2>
          <p className="text-gray-600 mb-8">
            Catatan, pengingat, dan kolaborasi - semua simpel.
          </p>
          <button
            onClick={() => setShowLoginModal(true)}
            className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition shadow-lg"
          >
            Login untuk Memulai
          </button>
        </div>
        {showLoginModal && (
          <LoginModal
            onClose={() => setShowLoginModal(false)}
            onLoginSuccess={loadNotes}
          />
        )}
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-blue-50 p-6 font-sans">
      <Header onLoginClick={() => setShowLoginModal(true)} />

      <main className="max-w-6xl mx-auto grid gap-6">
        <Controls
          onCreateNote={handleCreateNote}
          filter={filter}
          onFilterChange={setFilter}
        />

        {/* Error Message */}
        {error && (
          <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
            <strong>Error: </strong> {error}
            <button
              onClick={() => setError(null)}
              className="float-right text-red-900 font-bold"
            >
              ‚úï
            </button>
          </div>
        )}

        {/* Notification Status */}
        {Notification.permission === "granted" && (
          <div className="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
            <strong>‚úÖ Notifikasi Aktif</strong> - Anda akan menerima reminder 1
            jam dan 5 menit sebelum deadline
          </div>
        )}

        {Notification.permission === "denied" && (
          <div className="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded">
            <strong>‚ö†Ô∏è Notifikasi Dinonaktifkan</strong> - Aktifkan notifikasi
            browser untuk menerima reminder
          </div>
        )}

        {loading ? (
          <div className="text-center py-12">
            <div className="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
            <p className="text-gray-600 mt-4">Memuat catatan...</p>
          </div>
        ) : (
          <section className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-4">
            {filteredNotes.length > 0 ? (
              filteredNotes.map((note) => {
                // Safety check untuk setiap note
                if (!note || !note.id) {
                  console.warn("Invalid note:", note);
                  return null; // Skip invalid notes
                }

                return (
                  <NoteCard
                    key={note.id}
                    note={note}
                    onEdit={handleEditNote}
                    onDelete={() => handleDeleteNote(note.id)}
                  />
                );
              })
            ) : (
              <div className="col-span-full text-center text-gray-500 py-12">
                <div className="text-6xl mb-4">üìù</div>
                <h3 className="text-xl font-semibold mb-2">
                  Belum ada catatan
                </h3>
                <p className="text-gray-600">
                  Buat catatan pertama Anda untuk memulai
                </p>
                <button
                  onClick={handleCreateNote}
                  className="mt-4 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
                >
                  + Buat Note Pertama
                </button>
              </div>
            )}
          </section>
        )}

        <footer className="text-center text-sm text-slate-500 mt-8">
          IngetinAja - Catatan Pintar ‚Ä¢ Powered by Express.js + React
        </footer>
      </main>

      {showLoginModal && (
        <LoginModal
          onClose={() => setShowLoginModal(false)}
          onLoginSuccess={loadNotes}
        />
      )}

      {showNoteModal && (
        <NoteModal
          note={editingNote}
          onSave={handleSaveNote}
          onClose={() => {
            setShowNoteModal(false);
            setEditingNote(null);
          }}
        />
      )}
    </div>
  );
}

function App() {
  return (
    <AuthProvider>
      <AppContent />
    </AuthProvider>
  );
}

export default App;
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/CollaboratorModal.jsx">
import React, { useState, useEffect } from "react";
import { notesService, usersService } from "../services/api";

const CollaboratorModal = ({ note, onClose, onUpdate }) => {
  const [collaborators, setCollaborators] = useState([]);
  const [searchQuery, setSearchQuery] = useState("");
  const [searchResults, setSearchResults] = useState([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");
  const [isOwner, setIsOwner] = useState(false);

  useEffect(() => {
    loadCollaborators();
    checkOwnership();
  }, [note]);

  const loadCollaborators = async () => {
    try {
      setLoading(true);
      console.log("Loading collaborators for note:", note.id);
      const response = await notesService.getNoteCollaborators(note.id);
      console.log("Collaborators response:", response);

      // Pastikan response.data ada dan berupa array
      const collaborators = Array.isArray(response)
        ? response
        : response.data || [];
      setCollaborators(collaborators);
    } catch (error) {
      console.error("Error loading collaborators:", error);
      setError(
        "Gagal memuat daftar kolaborator: " + (error.message || "Unknown error")
      );
      setCollaborators([]);
    } finally {
      setLoading(false);
    }
  };

  const checkOwnership = () => {
    try {
      const currentUser = JSON.parse(localStorage.getItem("ingetinaja_user"));
      console.log("Current user:", currentUser);
      console.log("Note owner_id:", note.owner_id);

      // Periksa apakah current user adalah owner
      const userIsOwner = currentUser && note.owner_id === currentUser.id;
      console.log("User is owner:", userIsOwner);
      setIsOwner(userIsOwner);
    } catch (error) {
      console.error("Error checking ownership:", error);
      setIsOwner(false);
    }
  };

  const handleSearch = async (query) => {
    setSearchQuery(query);

    if (query.length < 2) {
      setSearchResults([]);
      return;
    }

    try {
      const results = await usersService.searchUsers(query);
      // Filter out current user and existing collaborators
      const currentUser = JSON.parse(localStorage.getItem("ingetinaja_user"));
      const filteredResults = results.filter(
        (user) =>
          user.id !== currentUser?.id &&
          !collaborators.some((collab) => collab.id === user.id)
      );
      setSearchResults(filteredResults);
    } catch (error) {
      console.error("Error searching users:", error);
    }
  };

  const handleAddCollaborator = async (username) => {
    try {
      setLoading(true);
      setError("");
      console.log("Adding collaborator:", username, "to note:", note.id);

      const response = await notesService.addCollaborator(note.id, username);
      console.log("Add collaborator response:", response);

      if (response.status === "success") {
        // Refresh collaborators list
        await loadCollaborators();
        setSearchQuery("");
        setSearchResults([]);

        // Call update callback
        onUpdate?.();

        // Show success message
        alert(`Berhasil menambahkan ${username} sebagai kolaborator`);
      } else {
        setError(response.message || "Gagal menambahkan kolaborator");
      }
    } catch (error) {
      console.error("Error adding collaborator:", error);
      setError(
        error.response?.data?.message ||
          error.message ||
          "Gagal menambahkan kolaborator"
      );
    } finally {
      setLoading(false);
    }
  };

  const handleRemoveCollaborator = async (collaboratorId) => {
    if (!window.confirm("Hapus kolaborator ini?")) return;

    try {
      setLoading(true);
      setError("");

      const response = await notesService.removeCollaborator(
        note.id,
        collaboratorId
      );

      if (response.status === "success") {
        // Refresh collaborators list
        await loadCollaborators();

        // Call update callback
        onUpdate?.();
      } else {
        setError(response.message || "Gagal menghapus kolaborator");
      }
    } catch (error) {
      console.error("Error removing collaborator:", error);
      setError(error.response?.data?.message || "Gagal menghapus kolaborator");
    } finally {
      setLoading(false);
    }
  };

  const handleShareWithAll = async () => {
    const usernames = searchResults.map((user) => user.username);

    console.log("Sharing with usernames:", usernames);

    if (usernames.length === 0) {
      setError("Pilih pengguna terlebih dahulu");
      return;
    }

    try {
      setLoading(true);
      setError("");

      const response = await notesService.shareNote(note.id, usernames);

      if (response.status === "success") {
        // Refresh collaborators list
        await loadCollaborators();
        setSearchQuery("");
        setSearchResults([]);

        // Call update callback
        onUpdate?.();

        // Show success message
        alert(`Berhasil membagikan note ke ${usernames.length} pengguna`);
      } else {
        setError(response.message || "Gagal membagikan note");
      }
    } catch (error) {
      console.error("Error sharing note:", error);
      setError(
        error.response?.data?.message ||
          error.message ||
          "Gagal membagikan note"
      );
    } finally {
      setLoading(false);
    }
  };

  if (!isOwner) {
    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div className="w-full max-w-md bg-white rounded-2xl shadow-2xl p-6">
          <div className="flex items-start justify-between mb-6">
            <h2 className="text-xl font-semibold text-slate-800">
              Kolaborator
            </h2>
            <button
              onClick={onClose}
              className="text-slate-600 hover:text-slate-800"
            >
              ‚úï
            </button>
          </div>

          <div className="text-center py-8">
            <div className="text-4xl mb-4">üîí</div>
            <h3 className="text-lg font-semibold text-slate-800 mb-2">
              Akses Ditolak
            </h3>
            <p className="text-slate-600 mb-6">
              Hanya pemilik note yang dapat mengelola kolaborator
            </p>
            <button
              onClick={onClose}
              className="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition"
            >
              Tutup
            </button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="w-full max-w-md bg-white rounded-2xl shadow-2xl p-6">
        <div className="flex items-start justify-between mb-6">
          <h2 className="text-xl font-semibold text-slate-800">
            Kelola Kolaborator
          </h2>
          <button
            onClick={onClose}
            className="text-slate-600 hover:text-slate-800"
          >
            ‚úï
          </button>
        </div>

        {/* Error Message */}
        {error && (
          <div className="mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-md">
            {error}
          </div>
        )}

        {/* Search Section */}
        <div className="mb-6">
          <h3 className="font-semibold text-slate-700 mb-2">
            Tambahkan Kolaborator
          </h3>
          <div className="flex gap-2 mb-4">
            <input
              type="text"
              placeholder="Cari username..."
              value={searchQuery}
              onChange={(e) => handleSearch(e.target.value)}
              className="flex-1 px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
            />
          </div>

          {/* Search Results */}
          {searchResults.length > 0 && (
            <div className="border rounded-md max-h-40 overflow-y-auto">
              {searchResults.map((user) => (
                <div
                  key={user.id}
                  className="flex items-center justify-between p-3 hover:bg-slate-50 border-b last:border-b-0"
                >
                  <div>
                    <div className="font-medium">{user.username}</div>
                    <div className="text-sm text-slate-500">{user.email}</div>
                  </div>
                  <button
                    onClick={() => handleAddCollaborator(user.username)}
                    disabled={loading}
                    className="px-3 py-1 bg-green-500 text-white text-sm rounded hover:bg-green-600 disabled:opacity-50"
                  >
                    Tambah
                  </button>
                </div>
              ))}
            </div>
          )}

          {searchQuery.length >= 2 && searchResults.length === 0 && (
            <div className="text-center text-slate-500 py-4">
              Tidak ada pengguna ditemukan
            </div>
          )}
        </div>

        {/* Current Collaborators */}
        <div className="mb-6">
          <h3 className="font-semibold text-slate-700 mb-2">
            Kolaborator ({collaborators.length})
          </h3>

          {loading ? (
            <div className="text-center py-4">
              <div className="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600"></div>
            </div>
          ) : collaborators.length > 0 ? (
            <div className="border rounded-md">
              {collaborators.map((collaborator) => (
                <div
                  key={collaborator.id}
                  className="flex items-center justify-between p-3 hover:bg-slate-50 border-b last:border-b-0"
                >
                  <div>
                    <div className="font-medium">{collaborator.username}</div>
                    <div className="text-sm text-slate-500">
                      {collaborator.email}
                      {collaborator.shared_at && (
                        <span className="ml-2 text-xs">
                          ‚Ä¢ Bergabung{" "}
                          {new Date(collaborator.shared_at).toLocaleDateString(
                            "id-ID"
                          )}
                        </span>
                      )}
                    </div>
                  </div>
                  <button
                    onClick={() => handleRemoveCollaborator(collaborator.id)}
                    disabled={loading}
                    className="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600 disabled:opacity-50"
                  >
                    Hapus
                  </button>
                </div>
              ))}
            </div>
          ) : (
            <div className="text-center text-slate-500 py-4">
              Belum ada kolaborator
            </div>
          )}
        </div>

        {/* Action Buttons */}
        <div className="flex justify-between gap-2">
          <button
            onClick={onClose}
            className="px-4 py-2 border border-slate-300 rounded-md hover:bg-slate-50 transition"
          >
            Tutup
          </button>

          {searchResults.length > 0 && (
            <button
              onClick={handleShareWithAll}
              disabled={loading}
              className="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition disabled:opacity-50"
            >
              Bagikan ke Semua
            </button>
          )}
        </div>
      </div>
    </div>
  );
};

export default CollaboratorModal;
</file>

<file path="src/components/Controls.jsx">
import React from "react";
import { notificationService } from "../services/notificationService";

const Controls = ({ onCreateNote, filter, onFilterChange }) => {
  const requestNotificationPermission = async () => {
    const hasPermission = await notificationService.requestPermission();

    if (hasPermission) {
      alert(
        "Notifikasi diaktifkan! Anda akan menerima reminder untuk catatan Anda."
      );
    } else {
      alert("Izin notifikasi ditolak. Anda tidak akan menerima reminder.");
    }
  };

  return (
    <section className="flex items-center justify-between gap-4">
      <div className="flex items-center gap-3">
        <button
          onClick={onCreateNote}
          className="px-4 py-2 bg-gradient-to-r from-indigo-600 to-violet-500 text-white rounded-lg shadow hover:shadow-md transition"
        >
          + Buat Note
        </button>
        <button
          onClick={requestNotificationPermission}
          className="px-4 py-2 border rounded-lg hover:bg-slate-50 transition"
        >
          {Notification.permission === "granted"
            ? "‚úÖ Notifikasi Aktif"
            : "Aktifkan Notifikasi"}
        </button>
      </div>

      {/* ... filter section */}
    </section>
  );
};

export default Controls;
</file>

<file path="src/components/Header.jsx">
import React from "react";
import { useAuth } from "../context/AuthContext";

const Header = ({ onLoginClick }) => {
  const { user, logout, isAuthenticated } = useAuth();

  return (
    <header className="max-w-6xl mx-auto mb-8 flex items-center justify-between">
      <div className="flex items-center gap-4">
        <div className="w-14 h-14 rounded-xl bg-gradient-to-tr from-indigo-600 to-violet-500 flex items-center justify-center text-white text-2xl font-extrabold shadow-lg">
          IA
        </div>
        <div>
          <h1 className="text-2xl font-bold text-slate-800">IngetinAja</h1>
          <p className="text-sm text-slate-500">
            Catatan, pengingat, dan kolaborasi ‚Äî semua simpel.
          </p>
        </div>
      </div>

      <div className="flex items-center gap-3">
        {!isAuthenticated ? (
          <button
            onClick={onLoginClick}
            className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
          >
            Masuk
          </button>
        ) : (
          <div className="flex items-center gap-3">
            <div className="text-sm text-slate-700">
              Hi, <span className="font-semibold">{user?.username}</span>
            </div>
            <button
              onClick={logout}
              className="px-3 py-2 border rounded-lg hover:bg-slate-50 transition"
            >
              Keluar
            </button>
          </div>
        )}
      </div>
    </header>
  );
};

export default Header;
</file>

<file path="src/components/LoginModal.jsx">
import React, { useState } from "react";
import { useAuth } from "../context/AuthContext.jsx";

const LoginModal = ({ onClose, onLoginSuccess }) => {
  const [activeTab, setActiveTab] = useState("login");
  const [loginData, setLoginData] = useState({ username: "", password: "" });
  const [registerData, setRegisterData] = useState({
    username: "",
    email: "",
    password: "",
    confirmPassword: "",
  });
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");
  const { login, register } = useAuth();

  const handleLogin = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError("");

    try {
      const result = await login(loginData);

      if (result.success) {
        onLoginSuccess?.();
        onClose();
      } else {
        setError(result.message || "Login gagal");
      }
    } catch (error) {
      console.error("Login error:", error);
      setError("Terjadi kesalahan saat login");
    } finally {
      setLoading(false);
    }
  };

  const handleRegister = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError("");

    // Validation
    if (registerData.password !== registerData.confirmPassword) {
      setError("Password dan konfirmasi password tidak cocok");
      setLoading(false);
      return;
    }

    if (registerData.password.length < 6) {
      setError("Password minimal 6 karakter");
      setLoading(false);
      return;
    }

    try {
      const result = await register({
        username: registerData.username,
        email: registerData.email,
        password: registerData.password,
      });

      if (result.success) {
        onLoginSuccess?.();
        onClose();
      } else {
        setError(result.message || "Registrasi gagal");
      }
    } catch (error) {
      console.error("Register error:", error);
      setError("Terjadi kesalahan saat registrasi");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="w-full max-w-md bg-white rounded-2xl shadow-2xl p-6">
        <div className="flex items-start justify-between mb-6">
          <h2 className="text-xl font-semibold text-slate-800">
            {activeTab === "login" ? "Masuk ke Akun Anda" : "Daftar Akun Baru"}
          </h2>
          <button
            onClick={onClose}
            className="text-slate-600 hover:text-slate-800"
          >
            ‚úï
          </button>
        </div>

        {/* Error Message */}
        {error && (
          <div className="mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-md">
            {error}
          </div>
        )}

        {/* Tabs */}
        <div className="flex bg-slate-100 p-1 rounded-lg mb-6">
          <button
            className={`flex-1 py-2 text-center rounded-md transition-all ${
              activeTab === "login"
                ? "bg-white text-indigo-600 font-semibold shadow-sm"
                : "text-slate-600 hover:text-slate-800"
            }`}
            onClick={() => setActiveTab("login")}
          >
            Masuk
          </button>
          <button
            className={`flex-1 py-2 text-center rounded-md transition-all ${
              activeTab === "register"
                ? "bg-white text-indigo-600 font-semibold shadow-sm"
                : "text-slate-600 hover:text-slate-800"
            }`}
            onClick={() => setActiveTab("register")}
          >
            Daftar
          </button>
        </div>

        {/* Login Form */}
        {activeTab === "login" && (
          <form onSubmit={handleLogin} className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-slate-700 mb-1">
                Username atau Email
              </label>
              <input
                type="text"
                placeholder="Masukkan username atau email"
                value={loginData.username}
                onChange={(e) =>
                  setLoginData({ ...loginData, username: e.target.value })
                }
                className="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                required
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-slate-700 mb-1">
                Password
              </label>
              <input
                type="password"
                placeholder="Masukkan password"
                value={loginData.password}
                onChange={(e) =>
                  setLoginData({ ...loginData, password: e.target.value })
                }
                className="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                required
              />
            </div>

            <button
              type="submit"
              disabled={loading}
              className="w-full py-2 px-4 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {loading ? "Memproses..." : "Masuk"}
            </button>

            <div className="text-center text-sm text-slate-500 mt-4">
              Belum punya akun?
              <button
                type="button"
                onClick={() => setActiveTab("register")}
                className="text-indigo-600 hover:text-indigo-500 font-medium ml-1 transition"
              >
                Daftar di sini
              </button>
            </div>

            {/* Demo credentials */}
            <div className="text-xs text-slate-400 text-center mt-4 p-3 bg-slate-50 rounded-lg">
              <p className="font-semibold">Demo Credentials:</p>
              <p>
                Username: <span className="font-mono">demo</span>
              </p>
              <p>
                Password: <span className="font-mono">demo123</span>
              </p>
            </div>
          </form>
        )}

        {/* Register Form */}
        {activeTab === "register" && (
          <form onSubmit={handleRegister} className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-slate-700 mb-1">
                Username
              </label>
              <input
                type="text"
                placeholder="Pilih username"
                value={registerData.username}
                onChange={(e) =>
                  setRegisterData({ ...registerData, username: e.target.value })
                }
                className="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                required
                minLength={3}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-slate-700 mb-1">
                Email
              </label>
              <input
                type="email"
                placeholder="Masukkan email Anda"
                value={registerData.email}
                onChange={(e) =>
                  setRegisterData({ ...registerData, email: e.target.value })
                }
                className="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                required
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-slate-700 mb-1">
                Password
              </label>
              <input
                type="password"
                placeholder="Buat password (minimal 6 karakter)"
                value={registerData.password}
                onChange={(e) =>
                  setRegisterData({ ...registerData, password: e.target.value })
                }
                className="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                required
                minLength={6}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-slate-700 mb-1">
                Konfirmasi Password
              </label>
              <input
                type="password"
                placeholder="Ulangi password"
                value={registerData.confirmPassword}
                onChange={(e) =>
                  setRegisterData({
                    ...registerData,
                    confirmPassword: e.target.value,
                  })
                }
                className="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                required
              />
            </div>

            <button
              type="submit"
              disabled={loading}
              className="w-full py-2 px-4 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {loading ? "Mendaftarkan..." : "Daftar"}
            </button>

            <div className="text-center text-sm text-slate-500 mt-4">
              Sudah punya akun?
              <button
                type="button"
                onClick={() => setActiveTab("login")}
                className="text-indigo-600 hover:text-indigo-500 font-medium ml-1 transition"
              >
                Masuk di sini
              </button>
            </div>
          </form>
        )}
      </div>
    </div>
  );
};

export default LoginModal;
</file>

<file path="src/components/NoteCard.jsx">
import React, { useState } from "react";
import CollaboratorModal from "./CollaboratorModal";

const NoteCard = ({ note, onEdit, onDelete }) => {
  // Safety check - jika note tidak valid, jangan render
  if (!note || typeof note !== "object") {
    console.warn("Invalid note in NoteCard:", note);
    return null;
  }

  const [showCollaboratorModal, setShowCollaboratorModal] = useState(false);

  // Di dalam handleEdit dan handleDelete, tambahkan logging
  const handleEdit = () => {
    if (!note.id) {
      console.error("Cannot edit note without ID:", note);
      return;
    }
    console.log("Editing note:", note);
    onEdit(note);
  };

  const handleDelete = async () => {
    if (!note.id) {
      console.error("Cannot delete note without ID:", note);
      return;
    }

    console.log("Deleting note:", note.id);

    if (window.confirm("Hapus note ini?")) {
      try {
        await onDelete();
      } catch (error) {
        console.error("Error deleting note:", error);
        alert("Gagal menghapus note: " + error.message);
      }
    }
  };

  // Default values untuk mencegah error
  const {
    title = "(Tanpa judul)",
    text = "",
    checklist = [],
    images = [],
    files = [],
    voices = [],
    reminder = null,
    collaborators = [],
    owner_name = "Unknown",
    owner_id = null,
    created_at = new Date().toISOString(),
    updated_at = new Date().toISOString(),
  } = note;

  // Get current user ID
  const getCurrentUserId = () => {
    try {
      const user = JSON.parse(localStorage.getItem("ingetinaja_user"));
      return user?.id;
    } catch (error) {
      console.error("Error getting current user:", error);
      return null;
    }
  };

  const currentUserId = getCurrentUserId();
  const isOwner = owner_id === currentUserId;

  const totalChecklist = checklist.length;
  const completedChecklist = checklist.filter(
    (item) => item && item.checked
  ).length;
  const checklistProgress =
    totalChecklist > 0
      ? Math.round((completedChecklist / totalChecklist) * 100)
      : 0;

  // FIXED: Format date function dengan better error handling
  const formatDate = (reminderData) => {
    try {
      if (!reminderData) return "Invalid Date";

      let date;

      // Handle berbagai format reminder
      if (reminderData.isoString) {
        date = new Date(reminderData.isoString);
      } else if (reminderData.timestamp) {
        date = new Date(reminderData.timestamp);
      } else if (reminderData.date && reminderData.time) {
        date = new Date(`${reminderData.date}T${reminderData.time}`);
      } else if (typeof reminderData === "string") {
        date = new Date(reminderData);
      } else {
        return "Invalid Date Format";
      }

      // Check if date is valid
      if (isNaN(date.getTime())) {
        console.warn("Invalid date object:", reminderData);
        return "Invalid Date";
      }

      return date.toLocaleString("id-ID", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
      });
    } catch (error) {
      console.error("Error formatting date:", error, reminderData);
      return "Invalid Date";
    }
  };

  // Helper function untuk mendapatkan waktu reminder
  const getReminderTime = (reminderData) => {
    if (!reminderData) return 0;

    try {
      if (reminderData.isoString) {
        return new Date(reminderData.isoString).getTime();
      } else if (reminderData.timestamp) {
        return reminderData.timestamp;
      } else if (reminderData.date && reminderData.time) {
        return new Date(`${reminderData.date}T${reminderData.time}`).getTime();
      } else if (typeof reminderData === "string") {
        return new Date(reminderData).getTime();
      }
    } catch (error) {
      console.error("Error getting reminder time:", error);
    }

    return 0;
  };

  const reminderTime = getReminderTime(reminder);
  const isSoon =
    reminderTime && reminderTime - Date.now() <= 24 * 60 * 60 * 1000;

  return (
    <article className="bg-white p-4 rounded-2xl shadow hover:shadow-lg transition relative">
      <div className="flex justify-between items-start gap-2">
        <div>
          <h3 className="font-semibold text-lg">{title}</h3>
          <p className="text-sm text-slate-600 mt-1">{text}</p>
        </div>
        <div className="flex flex-col items-end gap-1">
          {reminder && (
            <div
              className={`text-xs px-2 py-1 rounded-md ${
                isSoon
                  ? "bg-amber-100 text-amber-700"
                  : "bg-indigo-50 text-indigo-700"
              }`}
            >
              ‚è∞ {formatDate(reminder)}
            </div>
          )}
          <div className="text-xs text-slate-400 flex items-center gap-1">
            <span>by {owner_name}</span>
            {isOwner && collaborators && collaborators.length > 0 && (
              <span className="flex items-center">
                <span className="mx-1">‚Ä¢</span>
                <span className="text-blue-500">üë• {collaborators.length}</span>
              </span>
            )}
          </div>
        </div>
      </div>

      {checklist.length > 0 && (
        <div className="mt-3 space-y-2">
          <div className="space-y-1">
            <div className="flex justify-between items-center text-xs text-slate-500">
              <span>
                Checklist: {completedChecklist}/{totalChecklist} selesai
              </span>
              <span>{checklistProgress}%</span>
            </div>
            <div className="w-full bg-gray-200 rounded-full h-2">
              <div
                className="bg-green-500 h-2 rounded-full"
                style={{ width: `${checklistProgress}%` }}
              ></div>
            </div>
            <div className="space-y-1 max-h-32 overflow-y-auto">
              {checklist.map((item, index) => {
                if (!item || typeof item !== "object") return null;
                return (
                  <label
                    key={index}
                    className={`flex items-center gap-2 text-sm ${
                      item.checked ? "opacity-70" : ""
                    }`}
                  >
                    <input
                      type="checkbox"
                      checked={item.checked || false}
                      disabled
                      className="h-3 w-3"
                    />
                    <span
                      className={`truncate ${
                        item.checked ? "line-through text-gray-500" : ""
                      }`}
                    >
                      {item.text || "Empty item"}
                    </span>
                  </label>
                );
              })}
            </div>
          </div>
        </div>
      )}

      {/* Images Section */}
      {images && images.length > 0 && (
        <div className="mt-3">
          <div className="text-xs text-gray-500 font-medium mb-2">Gambar:</div>
          <div className="grid grid-cols-3 gap-2">
            {images.map((image, index) => (
              <img
                key={index}
                src={image.url}
                alt={image.originalName}
                className="w-full h-20 object-cover rounded-md border cursor-pointer hover:opacity-80 transition"
                onClick={() => window.open(image.url, "_blank")}
              />
            ))}
          </div>
        </div>
      )}

      {/* Files Section */}
      {files && files.length > 0 && (
        <div className="mt-3 space-y-1">
          <div className="text-xs text-gray-500 font-medium">
            File terlampir:
          </div>
          {files.map((file, index) => (
            <a
              key={index}
              href={file.url}
              target="_blank"
              rel="noopener noreferrer"
              className="flex items-center gap-2 text-sm text-indigo-600 hover:text-indigo-800 transition"
            >
              <span>üìé</span>
              <div className="flex-1 min-w-0">
                <div className="truncate">{file.originalName}</div>
                <div className="text-xs text-gray-500">
                  {formatFileSize(file.size)}
                </div>
              </div>
            </a>
          ))}
        </div>
      )}

      {/* Voices Section */}
      {voices && voices.length > 0 && (
        <div className="mt-3 space-y-2">
          <div className="text-xs text-gray-500 font-medium">Voice notes:</div>
          {voices.map((voice, index) => (
            <div key={index} className="flex items-center gap-2">
              <audio controls className="flex-1 h-8">
                <source src={voice.url} type={voice.mimetype} />
                Browser tidak mendukung audio.
              </audio>
              <div className="text-xs text-gray-500">
                {voice.duration ? `${voice.duration}s` : ""}
              </div>
            </div>
          ))}
        </div>
      )}

      <div className="mt-3 flex items-center justify-between gap-2">
        <div className="flex items-center gap-2 text-xs text-slate-500">
          <div>Created: {formatDate({ isoString: created_at })}</div>
          <div>‚Ä¢</div>
          <div>Updated: {formatDate({ isoString: updated_at })}</div>
        </div>
        <div className="flex items-center gap-2">
          {/* Tombol Kolaborator - hanya muncul jika user adalah pemilik note */}
          {isOwner && (
            <button
              onClick={() => setShowCollaboratorModal(true)}
              className="text-sm px-3 py-1 border border-blue-500 text-blue-500 rounded hover:bg-blue-50 transition flex items-center gap-1"
              title="Kelola Kolaborator"
            >
              <span>üë•</span>
              {collaborators && collaborators.length > 0 && (
                <span className="bg-blue-100 text-blue-600 text-xs px-1 rounded">
                  {collaborators.length}
                </span>
              )}
            </button>
          )}

          <button
            onClick={handleEdit}
            className="text-sm px-3 py-1 border rounded hover:bg-gray-50 transition"
          >
            Edit
          </button>
          <button
            onClick={handleDelete}
            className="text-sm px-3 py-1 border rounded hover:bg-gray-50 transition"
          >
            Hapus
          </button>
        </div>
      </div>

      {/* Modal Kolaborator */}
      {showCollaboratorModal && (
        <CollaboratorModal
          note={note}
          onClose={() => setShowCollaboratorModal(false)}
          onUpdate={() => {
            // Refresh note atau tampilkan pesan sukses
            console.log("Collaborators updated");
            // Anda bisa menambahkan callback untuk refresh notes di sini
          }}
        />
      )}
    </article>
  );
};

// Helper function untuk format file size
const formatFileSize = (bytes) => {
  if (bytes === 0) return "0 Bytes";
  const k = 1024;
  const sizes = ["Bytes", "KB", "MB", "GB"];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
};

export default NoteCard;
</file>

<file path="src/components/NoteModal.jsx">
import React, { useState, useEffect } from "react";
import ImageUploadArea from "./NoteModal/ImageUploadArea";
import FileUploadArea from "./NoteModal/FileUploadArea";
import VoiceRecorderArea from "./NoteModal/VoiceRecorderArea";

const NoteModal = ({ note, onSave, onClose }) => {
  const [formData, setFormData] = useState({
    title: "",
    text: "",
    checklist: [],
    images: [],
    files: [],
    voices: [],
    reminder: null,
    collaborators: [],
  });

  const [activeFeatures, setActiveFeatures] = useState({
    checklist: false,
    image: false,
    file: false,
    voice: false,
    reminder: false,
    collaborator: false,
  });

  useEffect(() => {
    if (note) {
      let parsedReminder = null;

      if (note.reminder) {
        if (typeof note.reminder === "string") {
          // Jika reminder adalah string (timestamp)
          const date = new Date(note.reminder);
          parsedReminder = {
            date: date.toISOString().split("T")[0],
            time: date.toTimeString().split(" ")[0].substring(0, 5),
            timestamp: date.getTime(),
          };
        } else if (note.reminder.timestamp) {
          // Jika reminder sudah dalam format object
          const date = new Date(note.reminder.timestamp);
          parsedReminder = {
            date: date.toISOString().split("T")[0],
            time: date.toTimeString().split(" ")[0].substring(0, 5),
            timestamp: note.reminder.timestamp,
          };
        } else if (note.reminder.date && note.reminder.time) {
          // Jika ada date dan time terpisah
          const dateTimeString = `${note.reminder.date}T${note.reminder.time}`;
          parsedReminder = {
            date: note.reminder.date,
            time: note.reminder.time,
            timestamp: new Date(dateTimeString).getTime(),
          };
        } else {
          // Jika format tidak dikenali, gunakan langsung
          parsedReminder = note.reminder;
        }
      }

      setFormData({
        title: note.title || "",
        text: note.text || "",
        checklist: note.checklist || [],
        images: note.images || [],
        files: note.files || [],
        voices: note.voices || [],
        reminder: parsedReminder,
        collaborators: note.collaborators || [],
      });

      setActiveFeatures({
        checklist: note.checklist && note.checklist.length > 0,
        image: note.images && note.images.length > 0,
        file: note.files && note.files.length > 0,
        voice: note.voices && note.voices.length > 0,
        reminder: !!note.reminder,
        collaborator: note.collaborators && note.collaborators.length > 0,
      });
    } else {
      setFormData({
        title: "",
        text: "",
        checklist: [],
        images: [],
        files: [],
        voices: [],
        reminder: null,
        collaborators: [],
      });
      setActiveFeatures({
        checklist: false,
        image: false,
        file: false,
        voice: false,
        reminder: false,
        collaborator: false,
      });
    }
  }, [note]);

  const handleSubmit = async (e) => {
    e.preventDefault();

    if (!formData.title && !formData.text) {
      alert("Judul atau teks catatan harus diisi");
      return;
    }

    // Process reminder data sebelum disimpan
    let processedReminder = null;
    if (activeFeatures.reminder && formData.reminder) {
      if (formData.reminder.date && formData.reminder.time) {
        const dateTimeString = `${formData.reminder.date}T${formData.reminder.time}`;
        const timestamp = new Date(dateTimeString).getTime();

        processedReminder = {
          date: formData.reminder.date,
          time: formData.reminder.time,
          timestamp: timestamp,
        };
      } else if (formData.reminder.timestamp) {
        // Jika sudah ada timestamp, gunakan langsung
        processedReminder = formData.reminder;
      }
    }

    const submitData = {
      title: formData.title,
      text: formData.text,
      checklist: activeFeatures.checklist ? formData.checklist : [],
      images: activeFeatures.image ? formData.images : [],
      files: activeFeatures.file ? formData.files : [],
      voices: activeFeatures.voice ? formData.voices : [],
      reminder: processedReminder,
      collaborators: activeFeatures.collaborator ? formData.collaborators : [],
    };

    await onSave(submitData);
  };

  const toggleFeature = (feature) => {
    setActiveFeatures((prev) => ({
      ...prev,
      [feature]: !prev[feature],
    }));

    // Jika reminder diaktifkan, inisialisasi dengan tanggal dan waktu default
    if (feature === "reminder" && !formData.reminder) {
      const now = new Date();
      const oneHourLater = new Date(now.getTime() + 60 * 60 * 1000); // 1 jam dari sekarang

      setFormData((prev) => ({
        ...prev,
        reminder: {
          date: oneHourLater.toISOString().split("T")[0],
          time: oneHourLater.toTimeString().split(" ")[0].substring(0, 5),
          timestamp: oneHourLater.getTime(),
        },
      }));
    }
  };

  // Checklist functions
  const addChecklistItem = () => {
    const newItem = { text: "Item baru", checked: false };
    setFormData((prev) => ({
      ...prev,
      checklist: [...prev.checklist, newItem],
    }));
  };

  const updateChecklistItem = (index, field, value) => {
    setFormData((prev) => ({
      ...prev,
      checklist: prev.checklist.map((item, i) =>
        i === index ? { ...item, [field]: value } : item
      ),
    }));
  };

  const removeChecklistItem = (index) => {
    setFormData((prev) => ({
      ...prev,
      checklist: prev.checklist.filter((_, i) => i !== index),
    }));
  };

  const clearCompletedChecklist = () => {
    setFormData((prev) => ({
      ...prev,
      checklist: prev.checklist.filter((item) => !item.checked),
    }));
  };

  const completedChecklist = formData.checklist.filter(
    (item) => item.checked
  ).length;
  const totalChecklist = formData.checklist.length;

  // Reminder functions - PERBAIKAN DI SINI
  const handleReminderChange = (field, value) => {
    setFormData((prev) => {
      const currentReminder = prev.reminder || {};

      if (field === "date" || field === "time") {
        // Simpan date dan time secara terpisah
        const updatedReminder = {
          ...currentReminder,
          [field]: value,
        };

        // Jika kedua field sudah terisi, buat timestamp
        if (updatedReminder.date && updatedReminder.time) {
          try {
            const dateTimeString = `${updatedReminder.date}T${updatedReminder.time}`;
            const dateObj = new Date(dateTimeString);

            // Validasi date
            if (isNaN(dateObj.getTime())) {
              console.error("Invalid date:", dateTimeString);
              updatedReminder.timestamp = null;
            } else {
              updatedReminder.timestamp = dateObj.getTime();
            }
          } catch (error) {
            console.error("Error parsing date:", error);
            updatedReminder.timestamp = null;
          }
        } else {
          updatedReminder.timestamp = null;
        }

        return {
          ...prev,
          reminder: updatedReminder,
        };
      }

      return prev;
    });
  };

  // Collaborator functions
  const [newCollaborator, setNewCollaborator] = useState("");
  const addCollaborator = () => {
    if (
      newCollaborator.trim() &&
      !formData.collaborators.includes(newCollaborator.trim())
    ) {
      setFormData((prev) => ({
        ...prev,
        collaborators: [...prev.collaborators, newCollaborator.trim()],
      }));
      setNewCollaborator("");
    }
  };

  const removeCollaborator = (index) => {
    setFormData((prev) => ({
      ...prev,
      collaborators: prev.collaborators.filter((_, i) => i !== index),
    }));
  };

  // Helper untuk menampilkan preview reminder
  const getReminderPreview = () => {
    if (!formData.reminder || !formData.reminder.timestamp) return null;

    try {
      const date = new Date(formData.reminder.timestamp);
      if (isNaN(date.getTime())) return null;

      return date.toLocaleString("id-ID", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
      });
    } catch (error) {
      return null;
    }
  };

  const reminderPreview = getReminderPreview();

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="w-full max-w-4xl bg-white rounded-2xl shadow-2xl p-6 max-h-[90vh] overflow-y-auto">
        <div className="flex items-start justify-between mb-4">
          <h2 className="text-xl font-semibold">
            {note ? "Edit Note" : "Tambah Note"}
          </h2>
          <button
            onClick={onClose}
            className="text-gray-600 hover:text-gray-800 text-xl"
          >
            ‚úï
          </button>
        </div>

        <form onSubmit={handleSubmit} className="space-y-4">
          <input
            type="text"
            placeholder="Judul (opsional)"
            value={formData.title}
            onChange={(e) =>
              setFormData((prev) => ({ ...prev, title: e.target.value }))
            }
            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
          />
          <textarea
            placeholder="Tulis catatan..."
            rows="4"
            value={formData.text}
            onChange={(e) =>
              setFormData((prev) => ({ ...prev, text: e.target.value }))
            }
            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
          />
          <div className="grid md:grid-cols-2 gap-3">
            <label className="flex items-center gap-2">
              <input
                type="checkbox"
                checked={activeFeatures.checklist}
                onChange={() => toggleFeature("checklist")}
                className="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
              />
              <span>Checklist (belanja/dst.)</span>
            </label>

            <label className="flex items-center gap-2">
              <input
                type="checkbox"
                checked={activeFeatures.image}
                onChange={() => toggleFeature("image")}
                className="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
              />
              <span>Upload Gambar</span>
            </label>

            <label className="flex items-center gap-2">
              <input
                type="checkbox"
                checked={activeFeatures.file}
                onChange={() => toggleFeature("file")}
                className="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
              />
              <span>Upload File</span>
            </label>

            <label className="flex items-center gap-2">
              <input
                type="checkbox"
                checked={activeFeatures.voice}
                onChange={() => toggleFeature("voice")}
                className="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
              />
              <span>Voice Note</span>
            </label>

            <label className="flex items-center gap-2">
              <input
                type="checkbox"
                checked={activeFeatures.reminder}
                onChange={() => toggleFeature("reminder")}
                className="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
              />
              <span>Reminder (tanggal & jam)</span>
            </label>

            <label className="flex items-center gap-2">
              <input
                type="checkbox"
                checked={activeFeatures.collaborator}
                onChange={() => toggleFeature("collaborator")}
                className="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
              />
              <span>Tambahkan Kolaborator</span>
            </label>
          </div>
          {/* Checklist Area */}
          {activeFeatures.checklist && (
            <div className="space-y-3 p-4 border rounded-lg bg-gray-50">
              <div className="flex justify-between items-center">
                <h3 className="font-semibold">Checklist</h3>
                <button
                  type="button"
                  onClick={addChecklistItem}
                  className="px-3 py-1 bg-green-500 text-white rounded-md text-sm hover:bg-green-600"
                >
                  + Tambah Item
                </button>
              </div>

              <div className="space-y-2 max-h-40 overflow-y-auto">
                {formData.checklist.map((item, index) => (
                  <div
                    key={index}
                    className="flex items-center gap-2 p-2 bg-white rounded border"
                  >
                    <input
                      type="checkbox"
                      checked={item.checked}
                      onChange={(e) =>
                        updateChecklistItem(index, "checked", e.target.checked)
                      }
                      className="h-4 w-4 text-indigo-600"
                    />
                    <input
                      type="text"
                      value={item.text}
                      onChange={(e) =>
                        updateChecklistItem(index, "text", e.target.value)
                      }
                      className="flex-1 px-2 py-1 border-none focus:outline-none focus:ring-1 focus:ring-indigo-500 rounded"
                      placeholder="Item checklist..."
                    />
                    <button
                      type="button"
                      onClick={() => removeChecklistItem(index)}
                      className="text-red-500 hover:text-red-700 px-2"
                    >
                      ‚úï
                    </button>
                  </div>
                ))}
              </div>

              {formData.checklist.length > 0 && (
                <div className="flex justify-between items-center text-sm">
                  <span className="text-gray-600">
                    Progress: {completedChecklist}/{totalChecklist} selesai
                  </span>
                  {completedChecklist > 0 && (
                    <button
                      type="button"
                      onClick={clearCompletedChecklist}
                      className="text-red-500 hover:text-red-700"
                    >
                      Hapus yang selesai
                    </button>
                  )}
                </div>
              )}
            </div>
          )}
          {/* Image Upload Area */}
          {activeFeatures.image && (
            <ImageUploadArea
              images={formData.images}
              onChange={(images) =>
                setFormData((prev) => ({ ...prev, images }))
              }
            />
          )}
          {/* File Upload Area */}
          {activeFeatures.file && (
            <FileUploadArea
              files={formData.files}
              onChange={(files) => setFormData((prev) => ({ ...prev, files }))}
            />
          )}
          {/* Voice Recorder Area */}
          {activeFeatures.voice && (
            <VoiceRecorderArea
              voices={formData.voices}
              onChange={(voices) =>
                setFormData((prev) => ({ ...prev, voices }))
              }
            />
          )}
          {/* Reminder Area - PERBAIKAN DI SINI */}
          {activeFeatures.reminder && (
            <div className="space-y-2 p-4 border rounded-lg bg-gray-50">
              <h3 className="font-semibold">Reminder</h3>
              <div className="grid grid-cols-2 gap-2">
                <input
                  type="date"
                  value={formData.reminder?.date || ""}
                  onChange={(e) => handleReminderChange("date", e.target.value)}
                  className="px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  min={new Date().toISOString().split("T")[0]} // Tidak bisa pilih tanggal kemarin
                />
                <input
                  type="time"
                  value={formData.reminder?.time || ""}
                  onChange={(e) => handleReminderChange("time", e.target.value)}
                  className="px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                />
              </div>

              {/* Preview Reminder */}
              {reminderPreview && (
                <div className="p-3 bg-blue-50 rounded-md">
                  <div className="text-sm font-medium text-blue-800">
                    ‚è∞ Reminder diatur untuk:
                  </div>
                  <div className="text-sm text-blue-600 mt-1">
                    {reminderPreview}
                  </div>
                </div>
              )}

              {/* Validation Error */}
              {formData.reminder?.date &&
                formData.reminder?.time &&
                !formData.reminder?.timestamp && (
                  <div className="p-2 bg-red-50 rounded-md">
                    <div className="text-sm text-red-600">
                      ‚ö†Ô∏è Tanggal atau waktu tidak valid
                    </div>
                  </div>
                )}

              <div className="text-sm text-gray-500">
                Notifikasi akan muncul 1 jam dan 5 menit sebelum waktu reminder.
              </div>
            </div>
          )}
          {/* Collaborator Area */}
          {activeFeatures.collaborator && (
            <div className="space-y-2 p-4 border rounded-lg bg-gray-50">
              <h3 className="font-semibold">Kolaborator</h3>
              <div className="flex gap-2">
                <input
                  type="text"
                  placeholder="Username collaborator"
                  value={newCollaborator}
                  onChange={(e) => setNewCollaborator(e.target.value)}
                  className="flex-1 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                />
                <button
                  type="button"
                  onClick={addCollaborator}
                  className="px-3 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"
                >
                  Tambahkan
                </button>
              </div>

              {formData.collaborators.length > 0 && (
                <div className="flex flex-wrap gap-2 mt-2">
                  {formData.collaborators.map(
                    (
                      username,
                      index // Simpan usernames
                    ) => (
                      <div
                        key={index}
                        className="px-2 py-1 bg-indigo-100 text-indigo-700 rounded-full flex items-center gap-1 text-sm"
                      >
                        {username}
                        <button
                          type="button"
                          onClick={() => removeCollaborator(index)}
                          className="text-indigo-500 hover:text-indigo-700"
                        >
                          ‚úï
                        </button>
                      </div>
                    )
                  )}
                </div>
              )}

              <div className="text-sm text-gray-500">
                Masukkan username untuk menambahkan kolaborator.
              </div>
            </div>
          )}

          <div className="flex justify-end gap-2 pt-4">
            <button
              type="button"
              onClick={onClose}
              className="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition"
            >
              Batal
            </button>
            <button
              type="submit"
              className="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition"
            >
              {note ? "Update Note" : "Simpan Note"}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default NoteModal;
</file>

<file path="src/components/NoteModal/FileUploadArea.jsx">
import React, { useRef } from "react";
import { uploadService } from "../../services/api";

const FileUploadArea = ({ files = [], onChange }) => {
  const fileInputRef = useRef(null);

  const handleFileUpload = async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    try {
      const response = await uploadService.uploadFile(file);
      const newFile = {
        filename: response.data.filename,
        originalName: response.data.originalName,
        url: response.data.url,
        mimetype: response.data.mimetype,
        size: response.data.size,
      };

      onChange([...files, newFile]);
    } catch (error) {
      console.error("Error uploading file:", error);
      alert("Gagal mengupload file: " + error.message);
    }

    // Reset file input
    if (fileInputRef.current) {
      fileInputRef.current.value = "";
    }
  };

  const removeFile = (index) => {
    const newFiles = files.filter((_, i) => i !== index);
    onChange(newFiles);
  };

  const formatFileSize = (bytes) => {
    if (bytes === 0) return "0 Bytes";
    const k = 1024;
    const sizes = ["Bytes", "KB", "MB", "GB"];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
  };

  return (
    <div className="space-y-3 p-4 border rounded-lg bg-gray-50">
      <h3 className="font-semibold">File</h3>

      <input
        type="file"
        ref={fileInputRef}
        onChange={handleFileUpload}
        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
      />

      <div className="text-sm text-gray-500">
        Upload file (PDF, DOC, TXT) - Maksimal 10MB
      </div>

      {files.length > 0 && (
        <div className="space-y-2 mt-3">
          {files.map((file, index) => (
            <div
              key={index}
              className="flex items-center justify-between p-3 bg-white rounded border"
            >
              <div className="flex-1 min-w-0">
                <div className="font-medium text-sm truncate">
                  {file.originalName}
                </div>
                <div className="text-xs text-gray-500">
                  {formatFileSize(file.size)} ‚Ä¢ {file.mimetype}
                </div>
              </div>
              <div className="flex items-center gap-2 ml-4">
                <a
                  href={file.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="px-3 py-1 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700 transition"
                >
                  Lihat
                </a>
                <button
                  type="button"
                  onClick={() => removeFile(index)}
                  className="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600 transition"
                >
                  Hapus
                </button>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};

export default FileUploadArea;
</file>

<file path="src/components/NoteModal/ImageUploadArea.jsx">
import React, { useRef } from "react";
import { uploadService } from "../../services/api";

const ImageUploadArea = ({ images = [], onChange }) => {
  const fileInputRef = useRef(null);

  const handleImageUpload = async (event) => {
    const files = Array.from(event.target.files);

    for (const file of files) {
      if (!file.type.startsWith("image/")) {
        alert("Hanya file gambar yang diizinkan");
        continue;
      }

      try {
        const response = await uploadService.uploadImage(file);
        const newImage = {
          filename: response.data.filename,
          originalName: response.data.originalName,
          url: response.data.url,
          mimetype: response.data.mimetype,
          size: response.data.size,
        };

        onChange([...images, newImage]);
      } catch (error) {
        console.error("Error uploading image:", error);
        alert("Gagal mengupload gambar: " + error.message);
      }
    }

    // Reset file input
    if (fileInputRef.current) {
      fileInputRef.current.value = "";
    }
  };

  const removeImage = (index) => {
    const newImages = images.filter((_, i) => i !== index);
    onChange(newImages);
  };

  return (
    <div className="space-y-3 p-4 border rounded-lg bg-gray-50">
      <h3 className="font-semibold">Gambar</h3>

      <input
        type="file"
        ref={fileInputRef}
        onChange={handleImageUpload}
        accept="image/*"
        multiple
        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
      />

      <div className="text-sm text-gray-500">
        Upload gambar (JPEG, PNG, GIF) - Maksimal 10MB per file
      </div>

      {images.length > 0 && (
        <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mt-3">
          {images.map((image, index) => (
            <div key={index} className="relative group">
              <img
                src={image.url}
                alt={image.originalName}
                className="w-full h-24 object-cover rounded-md border"
              />
              <button
                type="button"
                onClick={() => removeImage(index)}
                className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"
              >
                ‚úï
              </button>
              <div className="text-xs text-gray-600 truncate mt-1">
                {image.originalName}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};

export default ImageUploadArea;
</file>

<file path="src/components/NoteModal/VoiceRecorderArea.jsx">
import React, { useState, useRef } from "react";
import { uploadService } from "../../services/api";

const VoiceRecorderArea = ({ voices = [], onChange }) => {
  const [isRecording, setIsRecording] = useState(false);
  const [recordingTime, setRecordingTime] = useState(0);
  const mediaRecorderRef = useRef(null);
  const audioChunksRef = useRef([]);
  const timerRef = useRef(null);

  const startRecording = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const mediaRecorder = new MediaRecorder(stream);
      mediaRecorderRef.current = mediaRecorder;
      audioChunksRef.current = [];

      mediaRecorder.ondataavailable = (event) => {
        if (event.data.size > 0) {
          audioChunksRef.current.push(event.data);
        }
      };

      mediaRecorder.onstop = async () => {
        const audioBlob = new Blob(audioChunksRef.current, {
          type: "audio/webm",
        });
        await handleVoiceUpload(audioBlob);

        // Stop all tracks
        stream.getTracks().forEach((track) => track.stop());
      };

      mediaRecorder.start();
      setIsRecording(true);
      setRecordingTime(0);

      // Timer
      timerRef.current = setInterval(() => {
        setRecordingTime((prev) => prev + 1);
      }, 1000);
    } catch (error) {
      console.error("Error starting recording:", error);
      alert("Tidak dapat mengakses mikrofon: " + error.message);
    }
  };

  const stopRecording = () => {
    if (mediaRecorderRef.current && isRecording) {
      mediaRecorderRef.current.stop();
      setIsRecording(false);
      clearInterval(timerRef.current);
    }
  };

  const handleVoiceUpload = async (audioBlob) => {
    try {
      const file = new File([audioBlob], `voice-${Date.now()}.webm`, {
        type: "audio/webm",
      });

      const response = await uploadService.uploadVoice(file, recordingTime);
      const newVoice = {
        filename: response.data.filename,
        originalName: response.data.originalName,
        url: response.data.url,
        mimetype: response.data.mimetype,
        size: response.data.size,
        duration: response.data.duration,
      };

      onChange([...voices, newVoice]);
    } catch (error) {
      console.error("Error uploading voice:", error);
      alert("Gagal mengupload rekaman: " + error.message);
    }
  };

  const removeVoice = (index) => {
    const newVoices = voices.filter((_, i) => i !== index);
    onChange(newVoices);
  };

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, "0")}:${secs
      .toString()
      .padStart(2, "0")}`;
  };

  return (
    <div className="space-y-3 p-4 border rounded-lg bg-gray-50">
      <h3 className="font-semibold">Voice Note</h3>

      <div className="flex items-center gap-4">
        <button
          type="button"
          onClick={isRecording ? stopRecording : startRecording}
          className={`px-4 py-2 rounded-md text-white font-medium ${
            isRecording
              ? "bg-red-500 hover:bg-red-600"
              : "bg-green-500 hover:bg-green-600"
          } transition`}
        >
          {isRecording ? "‚èπÔ∏è Stop Rekam" : "üé§ Mulai Rekam"}
        </button>

        {isRecording && (
          <div className="flex items-center gap-2">
            <div className="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
            <span className="text-sm font-mono">
              {formatTime(recordingTime)}
            </span>
          </div>
        )}
      </div>

      <div className="text-sm text-gray-500">
        Klik tombol di atas untuk mulai merekam suara
      </div>

      {voices.length > 0 && (
        <div className="space-y-3 mt-3">
          {voices.map((voice, index) => (
            <div
              key={index}
              className="flex items-center justify-between p-3 bg-white rounded border"
            >
              <div className="flex-1">
                <div className="font-medium text-sm">
                  Rekaman Suara {index + 1}
                </div>
                <div className="text-xs text-gray-500">
                  Durasi: {formatTime(voice.duration)} ‚Ä¢ {voice.originalName}
                </div>
              </div>
              <div className="flex items-center gap-2 ml-4">
                <audio controls className="h-8">
                  <source src={voice.url} type={voice.mimetype} />
                  Browser tidak mendukung audio.
                </audio>
                <button
                  type="button"
                  onClick={() => removeVoice(index)}
                  className="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600 transition"
                >
                  Hapus
                </button>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};

export default VoiceRecorderArea;
</file>

<file path="src/context/AuthContext.jsx">
import React, { createContext, useState, useContext, useEffect } from "react";
import { authService } from "../services/api";

const AuthContext = createContext();

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error("useAuth must be used within an AuthProvider");
  }
  return context;
};

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // Check if user is logged in from localStorage
    const savedUser = localStorage.getItem("ingetinaja_user");
    const token = localStorage.getItem("token");

    if (savedUser && token) {
      try {
        const userData = JSON.parse(savedUser);
        setUser(userData);
        setIsAuthenticated(true);
      } catch (error) {
        console.error("Error parsing user data:", error);
        logout();
      }
    }
    setLoading(false);
  }, []);

  const login = async (credentials) => {
    try {
      const response = await authService.login(credentials);

      if (response.status === "success") {
        setUser(response.data.user);
        setIsAuthenticated(true);
        return { success: true, data: response.data };
      } else {
        return { success: false, message: response.message };
      }
    } catch (error) {
      console.error("Login error:", error);
      return {
        success: false,
        message: error.response?.data?.message || "Login failed",
      };
    }
  };

  const register = async (userData) => {
    try {
      const response = await authService.register(userData);

      if (response.status === "success") {
        setUser(response.data.user);
        setIsAuthenticated(true);
        return { success: true, data: response.data };
      } else {
        return { success: false, message: response.message };
      }
    } catch (error) {
      console.error("Register error:", error);
      return {
        success: false,
        message: error.response?.data?.message || "Registration failed",
      };
    }
  };

  const logout = () => {
    setUser(null);
    setIsAuthenticated(false);
    localStorage.removeItem("ingetinaja_user");
    localStorage.removeItem("token");
    localStorage.removeItem("ingetinaja_notes");
  };

  const value = {
    user,
    isAuthenticated,
    login,
    register,
    logout,
    loading,
  };

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
};
</file>

<file path="src/index.css">
@import 'tailwindcss/base';
@import 'tailwindcss/components';
@import 'tailwindcss/utilities';

/* Custom styles dari HTML original */
.glass {
  background: rgba(255,255,255,0.7);
  backdrop-filter: blur(6px);
}

@keyframes pop {
  from { 
    transform: translateY(6px); 
    opacity: 0; 
  }
  to { 
    transform: translateY(0); 
    opacity: 1; 
  }
}

.anim-pop { 
  animation: pop 0.28s ease; 
}

.checklist-item {
  transition: all 0.2s ease;
}

.checklist-item.checked {
  opacity: 0.7;
}

.checklist-item.checked .checklist-text {
  text-decoration: line-through;
  color: #6b7280;
}

.checklist-item:hover {
  background-color: #f9fafb;
}

.login-modal {
  background: rgba(0,0,0,0.5);
}

.form-tab {
  transition: all 0.3s ease;
}

.form-tab.active {
  background: white;
  color: #4f46e5;
  font-weight: 600;
}

.modal-center {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: #f1f5f9;
}

::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: #94a3b8;
}
</file>

<file path="src/main.jsx">
import React from "react";
import ReactDOM from "react-dom/client";
import App from "./App.jsx";
import "./index.css";

ReactDOM.createRoot(document.getElementById("root")).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
</file>

<file path="src/services/api.js">
import axios from "axios";

// Konfigurasi API
const API_URL = "http://localhost:5000/api";
const api = axios.create({
  baseURL: API_URL,
  headers: {
    "Content-Type": "application/json",
  },
});

// Interceptor untuk menambahkan token ke setiap request
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem("token");
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Interceptor untuk menangani response error
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // Token expired atau tidak valid
      localStorage.removeItem("token");
      localStorage.removeItem("ingetinaja_user");
      window.location.reload();
    }
    return Promise.reject(error);
  }
);

// Auth Service
export const authService = {
  async login(credentials) {
    try {
      const response = await api.post("/auth/login", credentials);

      if (response.data.status === "success") {
        localStorage.setItem("token", response.data.data.token);
        localStorage.setItem(
          "ingetinaja_user",
          JSON.stringify(response.data.data.user)
        );
      }

      return response.data;
    } catch (error) {
      console.error("Login error:", error);
      throw error;
    }
  },

  async register(userData) {
    try {
      const response = await api.post("/auth/register", userData);

      if (response.data.status === "success") {
        localStorage.setItem("token", response.data.data.token);
        localStorage.setItem(
          "ingetinaja_user",
          JSON.stringify(response.data.data.user)
        );
      }

      return response.data;
    } catch (error) {
      console.error("Registration error:", error);
      throw error;
    }
  },

  async getProfile() {
    try {
      const response = await api.get("/auth/profile");
      return response.data;
    } catch (error) {
      console.error("Get profile error:", error);
      throw error;
    }
  },

  logout() {
    localStorage.removeItem("token");
    localStorage.removeItem("ingetinaja_user");
  },
};

// Notes Service
export const notesService = {
  async getAllNotes(filter = "all") {
    try {
      const response = await api.get("/notes");
      return response.data.data || [];
    } catch (error) {
      console.error("Get all notes error:", error);
      throw error;
    }
  },

  async getNoteById(noteId) {
    try {
      const response = await api.get(`/notes/${noteId}`);
      return response.data;
    } catch (error) {
      console.error("Get note by ID error:", error);
      throw error;
    }
  },

  async createNote(noteData) {
    try {
      const response = await api.post("/notes", noteData);
      return response.data;
    } catch (error) {
      console.error("Create note error:", error);
      throw error;
    }
  },

  async updateNote(noteId, noteData) {
    try {
      const response = await api.put(`/notes/${noteId}`, noteData);
      return response.data;
    } catch (error) {
      console.error("Update note error:", error);
      throw error;
    }
  },

  async deleteNote(noteId) {
    try {
      const response = await api.delete(`/notes/${noteId}`);
      return response.data;
    } catch (error) {
      console.error("Delete note error:", error);
      throw error;
    }
  },

  async getNotesWithReminders() {
    try {
      const response = await api.get("/notes/filter/reminder");
      return response.data.data || [];
    } catch (error) {
      console.error("Get notes with reminders error:", error);
      throw error;
    }
  },

  async updateReminder(noteId, reminder) {
    try {
      const response = await api.patch(`/notes/${noteId}/reminder`, {
        reminder,
      });
      return response.data;
    } catch (error) {
      console.error("Update reminder error:", error);
      throw error;
    }
  },

  async getNoteCollaborators(noteId) {
    try {
      const response = await api.get(`/notes/${noteId}/collaborators`);
      return response.data.data || [];
    } catch (error) {
      console.error("Get note collaborators error:", error);
      throw error;
    }
  },

  async addCollaborator(noteId, collaboratorUsername) {
    try {
      const response = await api.post(`/notes/${noteId}/collaborators`, {
        collaboratorUsername,
      });
      return response.data;
    } catch (error) {
      console.error("Add collaborator error:", error);
      throw error;
    }
  },

  async removeCollaborator(noteId, collaboratorId) {
    try {
      const response = await api.delete(
        `/notes/${noteId}/collaborators/${collaboratorId}`
      );
      return response.data;
    } catch (error) {
      console.error("Remove collaborator error:", error);
      throw error;
    }
  },

  async shareNote(noteId, usernames) {
    try {
      const response = await api.patch(`/notes/${noteId}/share`, {
        collaborators: usernames
      });
      console.log("Share note response:", response.data);
      return response.data;
    } catch (error) {
      console.error("Share note error:", error);
      throw error;
    }
  },
};

// Users Service - PERBAIKAN
export const usersService = {
  async searchUsers(query) {
    try {
      console.log("Searching users with query:", query);
      const response = await api.get(`/users/search?q=${encodeURIComponent(query)}`);
      console.log("Search response:", response.data);
      return response.data.data || [];
    } catch (error) {
      console.error("Search users error:", error);
      // Fallback ke endpoint alternatif jika endpoint utama gagal
      try {
        const allUsersResponse = await api.get("/users");
        const allUsers = allUsersResponse.data.data || [];
        return allUsers.filter(user => 
          user.username.toLowerCase().includes(query.toLowerCase()) ||
          user.email.toLowerCase().includes(query.toLowerCase())
        );
      } catch (fallbackError) {
        console.error("Fallback search also failed:", fallbackError);
        throw error;
      }
    }
  },

  async getUserById(userId) {
    try {
      const response = await api.get(`/users/${userId}`);
      return response.data.data;
    } catch (error) {
      console.error("Get user by ID error:", error);
      throw error;
    }
  },

  async getAllUsers() {
    try {
      const response = await api.get("/users");
      return response.data.data || [];
    } catch (error) {
      console.error("Get all users error:", error);
      throw error;
    }
  },
};

// Upload Service
export const uploadService = {
  async uploadImage(file) {
    const formData = new FormData();
    formData.append("file", file);
    formData.append("type", "image");

    try {
      const response = await api.post("/upload", formData, {
        headers: {
          "Content-Type": "multipart/form-data",
        },
      });
      return response.data;
    } catch (error) {
      console.error("Upload image error:", error);
      throw error;
    }
  },

  async uploadFile(file) {
    const formData = new FormData();
    formData.append("file", file);
    formData.append("type", "file");

    try {
      const response = await api.post("/upload", formData, {
        headers: {
          "Content-Type": "multipart/form-data",
        },
      });
      return response.data;
    } catch (error) {
      console.error("Upload file error:", error);
      throw error;
    }
  },

  async uploadVoice(file, duration) {
    const formData = new FormData();
    formData.append("file", file);
    formData.append("type", "voice");

    try {
      const response = await api.post("/upload", formData, {
        headers: {
          "Content-Type": "multipart/form-data",
        },
      });

      // Tambahkan durasi ke response
      return {
        ...response.data,
        data: {
          ...response.data.data,
          duration: duration,
        },
      };
    } catch (error) {
      console.error("Upload voice error:", error);
      throw error;
    }
  },
};

// Health Check
export const healthService = {
  async check() {
    try {
      const response = await api.get("/health");
      return response.data;
    } catch (error) {
      console.error("Health check error:", error);
      throw error;
    }
  },
};

// Export default API instance
export default api;
</file>

<file path="src/services/notificationService.js">
class NotificationService {
  constructor() {
    this.scheduledNotifications = new Map();
    this.checkInterval = null;
    this.startNotificationChecker();
    console.log("NotificationService initialized");
  }

  // Request permission untuk notifications
  async requestPermission() {
    if (!("Notification" in window)) {
      console.warn("Browser tidak mendukung notifications");
      return false;
    }

    if (Notification.permission === "granted") {
      console.log("Notification permission already granted");
      return true;
    }

    if (Notification.permission !== "denied") {
      const permission = await Notification.requestPermission();
      console.log("Notification permission result:", permission);
      return permission === "granted";
    }

    console.log("Notification permission was denied previously");
    return false;
  }

  // Schedule notification untuk reminder
  scheduleReminderNotification(note, reminderTime) {
    console.log("Scheduling notification for note:", note.title, reminderTime);

    const now = Date.now();
    const reminderTimestamp = this.getReminderTimestamp(reminderTime);

    console.log("Reminder timestamp:", reminderTimestamp, "Now:", now);

    if (reminderTimestamp <= now) {
      console.log("Reminder sudah lewat:", note.title);
      return;
    }

    // Schedule untuk 1 jam sebelum
    const oneHourBefore = reminderTimestamp - 60 * 60 * 1000;
    console.log(
      "1 hour before:",
      oneHourBefore,
      "Time until:",
      oneHourBefore - now
    );

    if (oneHourBefore > now) {
      this.scheduleSingleNotification(
        note,
        oneHourBefore,
        `1 jam lagi: ${note.title}`,
        `Deadline: ${note.title}\n${note.text || "Tidak ada deskripsi"}`
      );
    } else {
      console.log("1 hour notification skipped (in past)");
    }

    // Schedule untuk 5 menit sebelum
    const fiveMinutesBefore = reminderTimestamp - 5 * 60 * 1000;
    console.log(
      "5 minutes before:",
      fiveMinutesBefore,
      "Time until:",
      fiveMinutesBefore - now
    );

    if (fiveMinutesBefore > now) {
      this.scheduleSingleNotification(
        note,
        fiveMinutesBefore,
        `5 menit lagi: ${note.title}`,
        `Segera deadline: ${note.title}\n${note.text || "Tidak ada deskripsi"}`
      );
    } else {
      console.log("5 minutes notification skipped (in past)");
    }

    console.log("Notifications scheduled for:", note.title);
  }

  // Schedule single notification
  scheduleSingleNotification(note, timestamp, title, body) {
    const notificationId = `note-${note.id}-${timestamp}`;
    const timeUntilNotification = timestamp - Date.now();

    console.log(
      `Scheduling ${title} in ${Math.round(
        timeUntilNotification / 1000 / 60
      )} minutes`
    );

    if (timeUntilNotification <= 0) {
      console.log("Notification time already passed");
      return;
    }

    const timeoutId = setTimeout(() => {
      console.log("Showing notification:", title);
      this.showNotification(note, title, body);
      this.scheduledNotifications.delete(notificationId);
    }, timeUntilNotification);

    this.scheduledNotifications.set(notificationId, timeoutId);
  }

  // Show actual notification
  async showNotification(note, title, body) {
    console.log("Attempting to show notification:", title);

    const hasPermission = await this.requestPermission();

    if (!hasPermission) {
      console.log("Notification permission denied, cannot show notification");
      return;
    }

    try {
      const notification = new Notification(title, {
        body: body,
        icon: "/vite.svg",
        tag: `note-${note.id}`,
        requireInteraction: true,
        badge: "/vite.svg",
      });

      console.log("Notification created successfully");

      notification.onclick = () => {
        console.log("Notification clicked");
        window.focus();
        notification.close();
      };

      notification.onclose = () => {
        console.log("Notification closed for:", note.title);
      };

      // Auto close setelah 30 detik
      setTimeout(() => {
        notification.close();
      }, 30000);
    } catch (error) {
      console.error("Error showing notification:", error);
    }
  }

  // Cancel semua scheduled notifications untuk note tertentu
  cancelNoteNotifications(noteId) {
    let cancelledCount = 0;
    for (const [notificationId, timeoutId] of this.scheduledNotifications) {
      if (notificationId.startsWith(`note-${noteId}-`)) {
        clearTimeout(timeoutId);
        this.scheduledNotifications.delete(notificationId);
        cancelledCount++;
      }
    }
    console.log(`Cancelled ${cancelledCount} notifications for note:`, noteId);
  }

  // Cancel semua notifications
  cancelAllNotifications() {
    let cancelledCount = 0;
    for (const [_, timeoutId] of this.scheduledNotifications) {
      clearTimeout(timeoutId);
      cancelledCount++;
    }
    this.scheduledNotifications.clear();
    console.log(`Cancelled all ${cancelledCount} notifications`);
  }

  // Helper function untuk mendapatkan timestamp dari reminder
  getReminderTimestamp(reminder) {
    if (!reminder) {
      console.log("No reminder data provided");
      return 0;
    }

    console.log("Processing reminder data:", reminder);

    try {
      if (reminder.isoString) {
        const timestamp = new Date(reminder.isoString).getTime();
        console.log("Using isoString:", reminder.isoString, "->", timestamp);
        return timestamp;
      } else if (reminder.timestamp) {
        console.log("Using timestamp:", reminder.timestamp);
        return reminder.timestamp;
      } else if (reminder.date && reminder.time) {
        const dateTimeString = `${reminder.date}T${reminder.time}`;
        const timestamp = new Date(dateTimeString).getTime();
        console.log("Using date/time:", dateTimeString, "->", timestamp);
        return timestamp;
      } else if (typeof reminder === "string") {
        const timestamp = new Date(reminder).getTime();
        console.log("Using string:", reminder, "->", timestamp);
        return timestamp;
      }
    } catch (error) {
      console.error("Error parsing reminder timestamp:", error);
    }

    console.log("No valid reminder format found");
    return 0;
  }

  // Background checker untuk notifications
  startNotificationChecker() {
    this.checkInterval = setInterval(() => {
      this.cleanupExpiredNotifications();
    }, 60000); // Check setiap menit
  }

  // Cleanup expired notifications
  cleanupExpiredNotifications() {
    const now = Date.now();
    let cleanedCount = 0;

    for (const [notificationId, timeoutId] of this.scheduledNotifications) {
      const timestamp = parseInt(notificationId.split("-").pop());
      if (timestamp <= now) {
        clearTimeout(timeoutId);
        this.scheduledNotifications.delete(notificationId);
        cleanedCount++;
      }
    }

    if (cleanedCount > 0) {
      console.log(`Cleaned up ${cleanedCount} expired notifications`);
    }
  }

  // Get scheduled notifications count (for debugging)
  getScheduledCount() {
    return this.scheduledNotifications.size;
  }

  // Stop notification service
  stop() {
    if (this.checkInterval) {
      clearInterval(this.checkInterval);
    }
    this.cancelAllNotifications();
    console.log("NotificationService stopped");
  }
}

// Export singleton instance
export const notificationService = new NotificationService();
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: ["./index.html", "./src/**/*.{js,ts,jsx,tsx}"],
  theme: {
    extend: {
      fontFamily: {
        sans: ["Inter", "system-ui", "sans-serif"],
      },
    },
  },
  plugins: [],
};
</file>

<file path="vite.config.js">
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,
    host: true,
  },
  css: {
    postcss: "./postcss.config.js",
  },
});
</file>

</files>
